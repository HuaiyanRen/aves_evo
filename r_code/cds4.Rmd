---
title: "cds4"
author: "u7151703"
date: "2024-08-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# grouping main clades
```{r}
abbmain_tree <- ape::read.tree("C:/Users/u7151703/OneDrive - Australian National University/Desktop/research/aves_evo/draft_results/63K_abb.treefile")

abbmain_tree <- root(abbmain_tree, outgroup = 'STRCAM', edgelabel = TRUE)

d2 <- fortify(abbmain_tree, branch.length = 'none') #63K_abb

grp <- list(Palaeognathae_1 = d2[[4]][345:363],
            Galloanseres_2 = d2[[4]][1:18],
            Mirandornithes_3 = d2[[4]][19:21],
            Columbimorphae_4 = d2[[4]][323:331],
            Otidimorphae_5 = d2[[4]][332:344],
            Opisthocomiformes_6 = d2[[4]][286],
            Cursorimorphae_7 = d2[[4]][287:322],
            Strisores_8 = d2[[4]][274:285],
            Phaethontimorphae_9 = d2[[4]][244:246],
            Aequornithes_10 = d2[[4]][247:273],
            Afroaves_11 = d2[[4]][206:243],
            Australaves_12 = d2[[4]][19:205]
            )

abbmain_tree <- groupOTU(abbmain_tree, grp, 'lab')
```

```{r}
p <- ggtree(abbmain_tree, branch.length = 'none', aes(color = lab))
p$data$lab <- factor(p$data$lab, levels = c('Palaeognathae_1','Galloanseres_2','Mirandornithes_3',
                                            'Columbimorphae_4','Otidimorphae_5','Opisthocomiformes_6',
                                            'Cursorimorphae_7','Strisores_8','Phaethontimorphae_9',
                                            'Aequornithes_10','Afroaves_11','Australaves_12'))
```


```{r}
p <- p +
  geom_tiplab(size = 1.5)+
  theme(legend.position="right")
```

```{r}
p %>% collapse(node = 391)
```


# comparson
```{r}
cds4mix_tree <- ape::read.tree("C:/Users/u7151703/OneDrive - Australian National University/Desktop/research/aves_evo/draft_results/cds4/partition12.treefile")
abbmain_tree <- ape::read.tree("C:/Users/u7151703/OneDrive - Australian National University/Desktop/research/aves_evo/draft_results/cds4/GALGAL_R00004.treefile")
```


```{r}
cds4mix_tree <- root(cds4mix_tree, outgroup = 'STRCAM', edgelabel = TRUE)
abbmain_tree <- root(abbmain_tree, outgroup = 'STRCAM', edgelabel = TRUE)
```

```{r}
cds4mix_tree <- groupOTU(cds4mix_tree, grp, 'lab')

p1 <- ggtree(cds4mix_tree, branch.length = 'none', aes(color = lab))

p1$data$lab <- factor(p1$data$lab, levels = c('Palaeognathae_1','Galloanseres_2','Mirandornithes_3',
                                            'Columbimorphae_4','Otidimorphae_5','Opisthocomiformes_6',
                                            'Cursorimorphae_7','Strisores_8','Phaethontimorphae_9',
                                            'Aequornithes_10','Afroaves_11','Australaves_12'))
d1 <- p1$data
```

```{r}
abbmain_tree <- groupOTU(abbmain_tree, grp, 'lab')

p2 <- ggtree(abbmain_tree, branch.length = 'none', aes(color = lab))

p2$data$lab <- factor(p2$data$lab, levels = c('Palaeognathae_1','Galloanseres_2','Mirandornithes_3',
                                            'Columbimorphae_4','Otidimorphae_5','Opisthocomiformes_6',
                                            'Cursorimorphae_7','Strisores_8','Phaethontimorphae_9',
                                            'Aequornithes_10','Afroaves_11','Australaves_12'))
d2 <- p2$data
```


```{r}
d2$x <- max(d2$x) - d2$x + max(d1$x) + 4
dd = bind_rows(d1,d2) %>% 
  filter(!is.na(label)) 
```

```{r}
p1 +
  geom_tree()+
  geom_tree(data = d2)+
  geom_tiplab(size = 1.5)+
  geom_nodelab(size = 1.5, nudge_x = -0.5, nudge_y = 0.6)+
  geom_nodelab(data=d2, size = 1.5, nudge_x = 0.5, nudge_y = 0.6 )+
  geom_line(aes(x, y, group=label), data=dd %>% filter(isTip), alpha=0.3)
```


```{r}
#p %>% collapse(node = 395)
#395 
```





